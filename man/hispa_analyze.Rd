% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/hispa_functions.R
\name{hispa_analyze}
\alias{hispa_analyze}
\title{Run HiSpa MCMC Analysis}
\usage{
hispa_analyze(
  contact_matrix,
  output_dir,
  mcmc_iterations = 6000L,
  num_clusters = 0L,
  mcmc_burn_in = 0L,
  mcmc_initial_sd = 0.1,
  mcmc_sd_floor = 1e-04,
  mcmc_sd_ceil = 0.3,
  use_cluster_init = FALSE,
  cluster_init_iterations = 1000L,
  cluster_initial_sd = 0.1,
  save_samples = FALSE,
  sample_interval = 50L,
  verbose = TRUE
)
}
\arguments{
\item{contact_matrix}{Numeric matrix, Hi-C contact frequencies (symmetric, n x n).
Alternatively, a character string path to a contact matrix file.}

\item{output_dir}{Character string specifying the output directory path.}

\item{mcmc_iterations}{Integer, number of MCMC iterations (default: 6000).}

\item{num_clusters}{Integer, number of clusters for hierarchical analysis. 
If 0 (default), automatically determined as sqrt(n).}

\item{mcmc_burn_in}{Integer, number of burn-in iterations to discard (default: 0).}

\item{mcmc_initial_sd}{Numeric, initial standard deviation for MCMC proposals (default: 0.1).}

\item{mcmc_sd_floor}{Numeric, minimum allowed standard deviation (default: 0.0001).}

\item{mcmc_sd_ceil}{Numeric, maximum allowed standard deviation (default: 0.3).}

\item{use_cluster_init}{Logical, use cluster-based initialization instead of 
random initialization (default: FALSE).}

\item{cluster_init_iterations}{Integer, number of iterations for cluster 
initialization MCMC (default: 1000).}

\item{cluster_initial_sd}{Numeric, initial standard deviation for cluster 
initialization MCMC (default: 0.1).}

\item{save_samples}{Logical, whether to save MCMC trace samples (default: FALSE).}

\item{sample_interval}{Integer, save samples every n iterations (default: 50).}

\item{verbose}{Logical, enable verbose output (default: TRUE).}
}
\value{
Invisibly returns the output directory path. All analysis results
  are saved as text files in the output directory (see Details).
}
\description{
Performs hierarchical Bayesian inference of 3D chromatin structure from
Hi-C contact matrix using MCMC sampling. This function follows the exact
workflow from the HiSpa C++ implementation.
}
\details{
This function implements the complete HiSpa workflow:
\enumerate{
  \item Load contact matrix from file
  \item Assign loci to clusters (k-means)
  \item Build cluster relationships
  \item Initialize structure (random or cluster-based)
  \item Assemble global structure
  \item Run main MCMC algorithm
  \item Save results to output directory
}

All results are automatically saved to the output directory:
\itemize{
  \item \strong{final_positions.txt} - Final inferred 3D coordinates (n x 3 matrix)
  \item \strong{initial_positions.txt} - Initial positions before MCMC (n x 3 matrix)
  \item \strong{log_likelihood_trace.txt} - MCMC log-likelihood values (convergence diagnostic)
  \item \strong{block_timings.txt} - Computation time for each MCMC block
  \item \strong{mcmc_log.txt} - Detailed analysis log with parameter values and settings
}

Read results using standard R functions:
\code{final_pos <- read.table("output_dir/final_positions.txt")}
\code{ll_trace <- scan("output_dir/log_likelihood_trace.txt")}
}
\examples{
# Load example contact matrix
data(su1_contact_mat)

# Check dimensions
dim(su1_contact_mat)

\donttest{
# Example 1: Run analysis with matrix input
hispa_analyze(
  contact_matrix = su1_contact_mat,
  output_dir = tempdir(),
  mcmc_iterations = 100,
  mcmc_burn_in = 10,
  use_cluster_init = FALSE,
  verbose = TRUE
)

# Read results from output directory
final_pos <- as.matrix(read.table(file.path(tempdir(), "final_positions.txt")))
head(final_pos)
}

}
